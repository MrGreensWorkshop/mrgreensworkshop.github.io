<!DOCTYPE html><html lang="en-US"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Let's create Zephyr RTOS based app and start debugging wi...</title><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" media="print" onload="this.media='all'"> <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"> </noscript><link rel="preconnect dns-prefetch" href="https://www.googletagmanager.com" crossorigin><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><meta name="google-site-verification" content="V8_OYoa-HOun0n_6OmlNBjYry1ZE9SZU1CwLv9GlD5k"><link rel="manifest" href="/assets/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" content="#f0f0f0"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Mr. Green's Workshop's App"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="msapplication-TileColor" content="#2d89ef"><meta name="msapplication-starturl" content="/"><meta name="application-name" content="Mr. Green's Workshop's App"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><link rel="alternate" hreflang="ja-JP" href="https://www.mrgreensworkshop.com/ja/2022-06-16-raspberry-pi-pico-zephyr-os-part-2" /><link rel="alternate" hreflang="ja" href="https://www.mrgreensworkshop.com/ja/2022-06-16-raspberry-pi-pico-zephyr-os-part-2" /><link rel="canonical" href="https://www.mrgreensworkshop.com/posts/2022-06-10-raspberry-pi-pico-zephyr-os-part-2" /><link rel="alternate" hreflang="x-default" href="https://www.mrgreensworkshop.com/posts/2022-06-10-raspberry-pi-pico-zephyr-os-part-2" /><link rel="alternate" hreflang="en-US" href="https://www.mrgreensworkshop.com/posts/2022-06-10-raspberry-pi-pico-zephyr-os-part-2" /><link rel="alternate" hreflang="en" href="https://www.mrgreensworkshop.com/posts/2022-06-10-raspberry-pi-pico-zephyr-os-part-2" /><meta name="keywords" content="Microcontrollers, Raspberry Pi Pico, Zephyr RTOS, PicoProbe"><meta name="description" content="How to Debug Zephyr OS RTOS with Raspberry Pi Pico using PicoProbe Hardware debugger interface on VS Code."><meta name="robots" content="index, follow"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Let's create Zephyr RTOS based app and start debugging with Raspber..."><meta name="twitter:site" content="@MrGreenWorkshop"><meta name="twitter:description" content="How to Debug Zephyr OS RTOS with Raspberry Pi Pico using PicoProbe Hardware debugger interface on VS Code."><meta name="twitter:image" content="https://www.mrgreensworkshop.com/assets/img/posts/id_raspi_pico_zephyr_os_part2/mainen.jpg"><meta property="og:site_name" content="Mr. Green's Workshop"><meta property="og:type" content="article"><meta property="og:title" content="Let's create Zephyr RTOS based app and start de..."><meta property="og:description" content="How to Debug Zephyr OS RTOS with Raspberry Pi Pico using PicoProbe Hardware debugger interface on VS Code."><meta property="og:url" content="https://www.mrgreensworkshop.com/posts/2022-06-10-raspberry-pi-pico-zephyr-os-part-2"><meta property="og:image" content="https://www.mrgreensworkshop.com/assets/img/posts/id_raspi_pico_zephyr_os_part2/mainen.jpg"><meta property="og:locale:alternate" content="ja_JP"><meta property="og:locale" content="en_US" ><meta property="article:author" content="Mr. Green's Workshop"><meta property="article:section" content="Microcontrollers"><meta property="article:tag" content="Raspberry Pi Pico"><meta property="article:tag" content="Zephyr RTOS"><meta property="article:tag" content="PicoProbe"> <script type="application/ld+json">{ "@context": "https://schema.org" ,"@graph": [ { "@type": "Person" ,"@id": "https://www.mrgreensworkshop.com/#person" ,"name": "Mr. Green's Workshop" ,"url": "https://www.mrgreensworkshop.com/tabs/about.html" ,"image": "https://www.mrgreensworkshop.com/assets/img/about/about.jpg" ,"description": "Creating Programming, Home Automation (IoT), Electronics, Microcontrollers, DIY, 3D Printers, Robots, Machining / CNC, Servers related projects." },{ "@type": "WebSite" ,"@id": "https://www.mrgreensworkshop.com/#website" ,"url": "https://www.mrgreensworkshop.com/" ,"name": "Mr. Green's Workshop" ,"description": "Creating Programming, Home Automation (IoT), Electronics, Microcontrollers, DIY, 3D Printers, Robots, Machining / CNC, Servers related projects." ,"publisher": {"@id": "https://www.mrgreensworkshop.com/#person"} ,"inLanguage": "en-US" ,"sameAs": ["https://www.youtube.com/@MrGreensWorkshop","https://twitter.com/MrGreenWorkshop","https://mastodon.social/@MrGreensWorkshop","https://www.instagram.com/mrgreensworkshop","https://github.com/MrGreensWorkshop","https://ko-fi.com/MrGreensWorkshop","https://www.patreon.com/MrGreensWorkshop"] ,"copyrightHolder" : {"@id": "https://www.mrgreensworkshop.com/#person"} ,"copyrightYear" : "2022" },{ "@type": "WebPage" ,"@id": "https://www.mrgreensworkshop.com/posts/2022-06-10-raspberry-pi-pico-zephyr-os-part-2#webpage" ,"url": "https://www.mrgreensworkshop.com/posts/2022-06-10-raspberry-pi-pico-zephyr-os-part-2" ,"name": "Let's create Zephyr RTOS based app and start debugging with Raspberry Pi Pico in VS Code" ,"isPartOf": {"@id": "https://www.mrgreensworkshop.com/#website"} ,"breadcrumb": {"@id": "https://www.mrgreensworkshop.com/posts/2022-06-10-raspberry-pi-pico-zephyr-os-part-2#breadcrumb"} ,"primaryImageOfPage": "https://www.mrgreensworkshop.com/assets/img/posts/id_raspi_pico_zephyr_os_part2/mainen.jpg" ,"description": "How to Debug Zephyr OS RTOS with Raspberry Pi Pico using PicoProbe Hardware debugger interface on VS Code." ,"inLanguage": "en-US" ,"potentialAction": { "@type": "ReadAction" ,"target": "https://www.mrgreensworkshop.com/posts/2022-06-10-raspberry-pi-pico-zephyr-os-part-2" } },{ "@type": "BreadcrumbList", "@id": "https://www.mrgreensworkshop.com/posts/2022-06-10-raspberry-pi-pico-zephyr-os-part-2#breadcrumb", "itemListElement": [ { "@type": "ListItem" ,"position": 1 ,"name": "Home" ,"item": "https://www.mrgreensworkshop.com/" }, { "@type": "ListItem" ,"position": 2 ,"name": "Blog" ,"item": "https://www.mrgreensworkshop.com/tabs/blog/" }, { "@type": "ListItem" ,"position": 3 ,"name": "Let's create Zephyr RTOS based app and start debugging with Raspberry Pi Pico in VS Code" } ] },{ "@type": "BlogPosting" ,"@id": "https://www.mrgreensworkshop.com/posts/2022-06-10-raspberry-pi-pico-zephyr-os-part-2#content" ,"isPartOf": {"@id": "https://www.mrgreensworkshop.com/posts/2022-06-10-raspberry-pi-pico-zephyr-os-part-2#webpage"} ,"mainEntityOfPage": {"@id": "https://www.mrgreensworkshop.com/posts/2022-06-10-raspberry-pi-pico-zephyr-os-part-2#webpage"} ,"publisher": {"@id": "https://www.mrgreensworkshop.com/#person"} ,"author": {"@id": "https://www.mrgreensworkshop.com/#person"} ,"inLanguage": "en-US" ,"headline": "Let's create Zephyr RTOS based app and start debugging with Raspberry Pi Pico in VS Code" ,"image": "https://www.mrgreensworkshop.com/assets/img/posts/id_raspi_pico_zephyr_os_part2/mainen.jpg" ,"thumbnailUrl": "https://www.mrgreensworkshop.com/assets/img/posts/id_raspi_pico_zephyr_os_part2/mainen.jpg" ,"articleSection": ["Microcontrollers", "Raspberry Pi Pico", "Zephyr RTOS", "PicoProbe"] ,"description": "How to Debug Zephyr OS RTOS with Raspberry Pi Pico using PicoProbe Hardware debugger interface on VS Code." ,"copyrightHolder" : {"@id": "https://www.mrgreensworkshop.com/#person"} ,"copyrightYear" : "2022" ,"wordCount": 1639 ,"articleBody": "In this post I will talk about, how to create Zephyr based applications and how to debug on Raspberry Pi Pico. I assume that you have finished set up the development environment. This video explains how to set up the development environment, so please watch it first if needed. Pick a sample application Let’s pick a sample application, close enough to what we want to do. This time I need a sample for external GPIO Interrupts. Let’s check Zephyr sample applications. $ cd ~/zephyrproject/zephyr/samples $ ls application_development drivers posix arch hello_world sensor basic index.rst shields bluetooth kernel subsys boards modules synchronization classic.rst net tfm_integration compression philosophers userspace $ cd basic $ ls basic.rst blinky_pwm fade_led rgb_led threads blinky button minimal servo_motor $ cd button $ ls CMakeLists.txt README.rst prj.conf sample.yaml src Let’s check button sample’s source code. Here is the GPIO interrupt config. cat src/main.c ... void main(void) { ... ret = gpio_pin_interrupt_configure_dt(&amp;button, GPIO_INT_EDGE_TO_ACTIVE); ... gpio_init_callback(&amp;button_cb_data, button_pressed, BIT(button.pin)); gpio_add_callback(button.port, &amp;button_cb_data); ... } I will use this sample for my application base. How to make standalone Zephyr-based applications There are 3 types of applications. Applications in zephyrproject/zephyr/ folder called as Zephyr repository applications. Applications in zephyrproject/ folder called as Zephyr workspace applications. Applications outside of zephyrproject folder called as Zephyr freestanding applications. &lt;home&gt;/ ├─── zephyrproject/ │ ├─── .west/ │ │ └─── config │ ├─── zephyr/ │ │ ├── arch/ │ │ ├── boards/ │ │ ├── cmake/ │ │ ├── samples/ │ │ │ ├── hello_world/ -&gt; Zephyr repository application │ │ │ └── ... │ │ ├── tests/ │ │ └── ... │ ├── bootloader/ │ ├── modules/ │ ├── ... │ └── applications/ │ └── app/ -&gt; Zephyr workspace application │ └─── app/ -&gt; Zephyr freestanding application ├── CMakeLists.txt ├── prj.conf └── src/ └── main.c Zephyr Project Reference: Application Development This time I will use freestanding application. Let’s start by copying the button sample folder. Please don’t use spaces for folder names. Otherwise it will not work. cd ~/ cp -R ~/zephyrproject/zephyr/samples/basic/button ~/Desktop/gpio_int_test First I will try to compile for nucleo board because button sample does work with no change. $ cd ~/Desktop/gpio_int_test $ west build -b nucleo_f411re usage: west [-h] [-z ZEPHYR_BASE] [-v] [-V] &lt;command&gt; ... west: error: argument &lt;command&gt;: invalid choice: 'build' (choose from 'init', 'update', 'list', 'manifest', 'diff', 'status', 'forall', 'help', 'config', 'topdir', 'selfupdate') $ According to documentation, we need to set some environment variables. But don’t rush, we will fix this later. Zephyr Project Reference: Environment Variables Temporarily, I will run Zephyr environment script. With this, environment variables last until terminal closes. $ source ~/zephyrproject/zephyr/zephyr-env.sh $ west build -b nucleo_f411re -- west build: generating a build system Loading Zephyr default modules (Zephyr base). -- Application: /Users/user/Desktop/gpio_int_test -- Found Python3: /usr/local/opt/python@3.9/bin/python3.9 (found suitable exact version \"3.9.13\") found components: Interpreter -- Cache files will be written to: /Users/user/Library/Caches/zephyr -- Zephyr version: 3.0.99 (/Users/user/zephyrproject/zephyr) -- Found west (found suitable version \"0.13.1\", minimum required is \"0.7.1\") -- Board: nucleo_f411re ... [156/156] Linking C executable zephyr/zephyr.elf Memory region Used Size Region Size %age Used FLASH: 15108 B 512 KB 2.88% SRAM: 4416 B 128 KB 3.37% IDT_LIST: 0 GB 2 KB 0.00% Successfully compiled. VS Code project setup Let’s setup standalone Zephyr application on VS Code. Open the project folder we just copied in VS Code. Delete build folder. Let’s add Zephyr environment variables to VS Code. With this, environment variables are added to VS Code’s terminal. Create a new folder named .vscode Create a new file named settings.json inside of it. Copy and paste the config written below. { \"terminal.integrated.env.osx\": { \"PATH\": \"$HOME/zephyrproject/zephyr/scripts\", \"ZEPHYR_BASE\": \"${env:HOME}/zephyrproject/zephyr\", }, \"terminal.integrated.env.linux\": { \"PATH\": \"$HOME/zephyrproject/zephyr/scripts:${env:PATH}\", \"ZEPHYR_BASE\": \"${env:HOME}/zephyrproject/zephyr\", }, \"terminal.integrated.env.windows\": { \"PATH\": \"${env:USERPROFILE}\\\\zephyrproject\\\\zephyr\\\\scripts;${env:PATH}\", \"ZEPHYR_BASE\": \"${env:USERPROFILE}\\\\zephyrproject\\\\zephyr\", }, } You can find more about VS Code workspace settings from here. Then reopen the VS Code open terminal inside VS Code and try to compile. $ west build -b nucleo_f411re -- west build: generating a build system Loading Zephyr default modules (Zephyr base). -- Application: /Users/user/Desktop/gpio_int_test -- Found Python3: /usr/local/opt/python@3.9/bin/python3.9 (found suitable exact version \"3.9.13\") found components: Interpreter -- Cache files will be written to: /Users/user/Library/Caches/zephyr -- Zephyr version: 3.0.99 (/Users/user/zephyrproject/zephyr) -- Found west (found suitable version \"0.13.1\", minimum required is \"0.7.1\") -- Board: nucleo_f411re ... [156/156] Linking C executable zephyr/zephyr.elf Memory region Used Size Region Size %age Used FLASH: 15108 B 512 KB 2.88% SRAM: 4416 B 128 KB 3.37% IDT_LIST: 0 GB 2 KB 0.00% Successfully compiled. Let’s set our board name. Open the CMakeLists file and add this set(BOARD rpi_pico) after cmake_minimum_required ... cmake_minimum_required(VERSION 3.20.0) set(BOARD rpi_pico) ... Let’s try to build without board option. $ west build -p ... /Users/user/Desktop/gpio_int_test/src/main.c:22:2: error: #error \"Unsupported board: sw0 devicetree alias is not defined\" 22 | #error \"Unsupported board: sw0 devicetree alias is not defined\" | ^~~~~ [117/160] Building C object zephyr/drivers/gpio/CMakeFiles/drivers__gpio.dir/gpio_rpi_pico.c.obj ninja: build stopped: subcommand failed. FATAL ERROR: command exited with status 1: /usr/local/bin/cmake --build /Users/user/Desktop/gpio_int_test/build We have compile error because raspberry pi pico board doesn’t have switch. Adding switch0 Let’s add switch0, for this we will use app overlay file. Let’s check switch0 definition in nucleo board’s device overlay file. $ cat /Users/wizard/zephyrproject/zephyr/boards/arm/nucleo_f411re/nucleo_f411re.dts ... / { gpio_keys { compatible = \"gpio-keys\"; user_button: button { label = \"User\"; gpios = &lt;&amp;gpioc 13 GPIO_ACTIVE_LOW&gt;; }; }; aliases { led0 = &amp;green_led_2; sw0 = &amp;user_button; }; }; ... Let’s create a new app.overlay file and put what we need in it. / { gpio_keys { compatible = \"gpio-keys\"; user_button: button { label = \"User\"; gpios = &lt;&amp;gpio0 28 GPIO_ACTIVE_LOW&gt;; }; }; aliases { sw0 = &amp;user_button; }; }; Zephyr Project Reference: Devicetree HOWTOs In my circuit, the switch connected to GPIO 28. I will show the schematic later. Let’s try to compile. $ west build -p WARNING: This looks like a fresh build and BOARD is unknown; so it probably won't work. To fix, use --board=&lt;your-board&gt;. Note: to silence the above message, run 'west config build.board_warn false' -- west build: generating a build system ... [160/160] Linking C executable zephyr/zephyr.elf Memory region Used Size Region Size %age Used BOOT_FLASH: 256 B 256 B 100.00% FLASH: 11940 B 2096896 B 0.57% SRAM: 3760 B 264 KB 1.39% IDT_LIST: 0 GB 2 KB 0.00% Converting to uf2, output size: 24576, start address: 0x10000000 Wrote 24576 bytes to zephyr.uf2 $ gpio_int_test % Voilà! Our binary file is located in build/zephyr folder. For more about west command please check the link below. Zephyr Project Reference: Building, Flashing and Debugging How to debug? On-chip debugging with Zephyr RTOS + App on Raspberry Pi Pico What we need? Hardware debugger interface (SWD) A Raspberry Pi Pico flashed with picoprobe firmware Software for on-chip debugging OpenOCD build for picoprobe Arm toolchain arm-none-eabi-gdb Cortex-Debug extension for VS Code For on-chip debugging we need some hardware and software. Let’s prepare one by one. Hardware debugger interface First hardware, I will use picoprobe for Hardware debugger interface. Let’s get the compiled binary for picoprobe and flash to Raspberry Pi Pico. Open this link. Find the link under the title Debugging using another Raspberry Pi Pico and download from Download the UF2 file Put the Raspberry Pi Pico into bootloader mode by pushing bootsel button, while plugging to your computer. Then copy the UF2 file to your Pico’s storage. $ cp ~/Downloads/picoprobe.uf2 /Volumes/RPI-RP2/ Building OpenOCD Currently OpenOCD does not officially support the picoprobe. So, we need to build a specific version of OpenOCD. For macOS cd ~/ brew install libtool automake libusb wget pkg-config gcc texinfo git clone https://github.com/raspberrypi/openocd.git --branch picoprobe --depth=1 cd openocd export PATH=\"/usr/local/opt/texinfo/bin:$PATH\" ./bootstrap ./configure --enable-picoprobe --disable-werror make -j4 For Linux cd ~/pico sudo apt install automake autoconf build-essential texinfo libtool libftdi-dev libusb-1.0-0-dev git clone https://github.com/raspberrypi/openocd.git --branch picoprobe --depth=1 --no-single-branch cd openocd ./bootstrap ./configure --enable-picoprobe make -j4 sudo make i Since this is a Pico-specific version of OpenOCD, you don’t need to run “make install”. We will add OpenOCD’s paths to VS Code later. Let’s check the OpenOCD. $ ~/openocd/src/openocd --version Open On-Chip Debugger 0.11.0-g4f2ae61 (2022-06-08-15:59) Licensed under GNU GPL v2 For bug reports, read http://openocd.org/doc/doxygen/bugs.html Installing ARM tools For macOS cd ~/ brew tap eblot/armeabi brew install arm-none-eabi-gdb Let’s check the arm-none-eabi-gdb. $ arm-none-eabi-gdb --version GNU gdb (GDB) 10.1 Copyright (C) 2020 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt; This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. VS Code Settings First install Cortex-Debug extension. Open settings.json file and add OpenOCD binary path. { \"cortex-debug.openocdPath\": \"${env:HOME}/openocd/src/openocd\", ... Create a new file named launch.json inside of .vscode folder and add all these settings. { \"version\": \"0.2.0\", \"configurations\": [{ \"name\": \"Pico Zephyr Debug\", \"device\": \"RP2040\", \"gdbPath\": \"arm-none-eabi-gdb\", \"cwd\": \"${workspaceRoot}\", \"executable\": \"build/zephyr/zephyr.elf\", \"request\": \"launch\", \"type\": \"cortex-debug\", \"servertype\": \"openocd\", \"configFiles\": [ \"/interface/picoprobe.cfg\", \"/target/rp2040.cfg\" ], \"searchDir\": [\"${env:HOME}/openocd/tcl\"], \"svdFile\": \"${env:HOME}/zephyrproject/modules/hal/rpi_pico/src/rp2040/hardware_regs/rp2040.svd\", \"runToEntryPoint\": \"main\", \"postRestartCommands\": [ \"break main\", \"continue\" ] }] } Final Schematic This is the schematic for my setup. Hardware debugger interface on the left, and the target board with the button on the right. Let’s start debugging Open main.c and click the left side of line numbers. Breakpoints will be added accordingly. Don’t forget to compile before debugging. Then click the Run and Debug icon on the left, and click Start Debugging on top left. Voilà! Let’s check with the serial terminal to see Zephyr console output. I will push the button and check the console output. Awesome! You Can Support My Work Creating projects like this takes a great amount of time. Much appreciated if you consider supporting me so that I can continue projects like this and creating new contents for everyone. You might consider supporting me via GitHub Sponsors, Patreon, or Ko-fi. For links, please see the About page. Final words You can access the Raspberry Pi Pico Zephyr RTOS VS Code project from this link. Don’t forget to check out the Zephyr RTOS Real Application Tutorial series." } ] }</script><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><link href="/assets/css/main.css" rel="stylesheet"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v0.4.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.css"><link href="/assets/css/nav-media.css" rel="stylesheet"></head><body > <script src="/assets/js/color-scheme-attr-init.js" data-mode="false"></script><nav class="navbar navbar-default top-nav"><div class="navbar-header"> <button type="button" aria-label="Side menu" class="navbar-toggle collapsed pull-left top-nav-menu-toggle" data-toggle="collapse" data-target="#id_top-nav-menu-toggle" aria-expanded="false"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand top-nav-brand" href="/" translate="no">Mr. Green's Workshop</a></div><div class="color_scheme_switch_top_holder" data-toggle="tooltip" data-placement="bottom" title="Color scheme"> <label class="color-scheme-switch hover-effect"> <input type="checkbox" class="checkbox_color_switch" /> <span></span> </label></div></nav><nav id="side-nav-container"><div class="side-nav"><div class="side-nav-brand"> <img src="/assets/img/about/about.jpg" alt=""><div class="brand-holder"></div><p>&nbsp;</p><br><div class="lang-switch"><p>[&nbsp;</p><ul translate="no"><li lang="en-US"><a href="/posts/2022-06-10-raspberry-pi-pico-zephyr-os-part-2" class=" active-page hover-effect">En&nbsp;</a></li><li lang="ja-JP"><a href="/ja/2022-06-16-raspberry-pi-pico-zephyr-os-part-2" class=" hover-effect">Jp&nbsp;</a></li></ul><p>]</p></div></div><br> <a href="javascript:void(0);" class="side-nav-close" role="button" rel="nofollow"> <i class="fa fa-angle-double-left fa-2x" aria-hidden="true"></i> </a><hr> <br><div class="side-nav-buttons"><ul class="nav nav-pills nav-stacked"><li ><a href="/" class=" hover-effect"><i class="fa-fw fa fa-home" aria-hidden="true"></i>Home</a></li><li ><a href="/tabs/blog/" class="active-page hover-effect"><i class="fa-fw fa fa-pencil-square-o" aria-hidden="true"></i>Blog</a></li><li ><a href="/tabs/archive.html" class=" hover-effect"><i class="fa-fw fa fa-archive" aria-hidden="true"></i>Archive</a></li><li ><a href="/tabs/about.html" class=" hover-effect"><i class="fa-fw fa fa-user-o" aria-hidden="true"></i>About</a></li></ul></div><br> <br><div class="contact-container"><hr><h3>Contact</h3><ul><li><a href="https://www.youtube.com/@MrGreensWorkshop" aria-label="youtube" class="hover-effect-big" target="_blank" rel="noopener noreferrer"><i class="fa fa-youtube-play" aria-hidden="true"></i></a></li><li><a href="https://twitter.com/MrGreenWorkshop" aria-label="twitter" class="hover-effect-big" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a href="https://mastodon.social/@MrGreensWorkshop" aria-label="mastodon" class="hover-effect-big" target="_blank" rel="me noopener noreferrer"><img src="/assets/img/default/mastodon.svg" alt="mastodon"/></a></li><li><a href="https://www.instagram.com/mrgreensworkshop" aria-label="instagram" class="hover-effect-big" target="_blank" rel="noopener noreferrer"><i class="fa fa-instagram" aria-hidden="true"></i></a></li><li><a href="https://github.com/MrGreensWorkshop" aria-label="github" class="hover-effect-big" target="_blank" rel="noopener noreferrer"><i class="fa fa-github" aria-hidden="true"></i></a></li><li><a href="https://ko-fi.com/MrGreensWorkshop" aria-label="ko-fi" class="hover-effect-big" target="_blank" rel="noopener noreferrer"><img src="/assets/img/default/kofi.svg" alt="ko-fi"/></a></li><li><a href="https://www.patreon.com/MrGreensWorkshop" aria-label="patreon" class="hover-effect-big" target="_blank" rel="noopener noreferrer"><img src="/assets/img/default/patreon.svg" alt="patreon"/></a></li></ul></div><hr id="toc-view-top"><div class="side-nav-footer" translate="no"><p>&copy; 2022 Mr. Green's Workshop.</p></div></div><div class="side-nav-bottom-buttons-container"><hr><ul><li><div class="color_scheme_switch_side_holder" data-toggle="tooltip" data-placement="top" title="Color scheme"> <label class="color-scheme-switch hover-effect"> <input type="checkbox" class="checkbox_color_switch" /> <span></span> </label></div></li><li><div class="cookie-icon hover-effect" onclick="CookieConsent.showSettings();" data-toggle="tooltip" data-placement="top" title="Cookie settings"><div class="cookie-wrapper"> <i class="fa fa-circle bitten-cookie" aria-hidden="true"></i> <i class="fa fa-circle small-ellipse-icon" aria-hidden="true"></i> <i class="fa fa-spinner inner-icon" aria-hidden="true"></i> <i class="fa fa-circle-thin outer-icon" aria-hidden="true"></i></div></div></li></ul></div></nav><div id="toc-container" class="movable"><div class="panel panel-default"><div class="panel-heading" data-toggle="tooltip" data-placement="top" title="Drag to move"> Contents <span class="pull-right"> <a href="javascript:void(0);" aria-label="Close" role="button" rel="nofollow" class="close-button" onclick="document.getElementById('toc-container').style.display = 'none';"> <i class="fa fa-times" data-toggle="tooltip" data-placement="bottom" title="Close"></i> </a> </span></div><div class="panel-body"><nav id="table-of-contents"></nav></div></div></div><div id="main-wrapper"><div class="main-container"><div class="multipurpose-container post-container"><div class="post-title"><h1>Let's create Zephyr RTOS based app and start debugging with Raspberry Pi Pico in VS Code</h1></div><div class="meta"> <small> &nbsp;<i class="fa fa-calendar"></i>&nbsp;&nbsp;Jun 10, 2022 </small> <small> &nbsp;&nbsp;&nbsp;<span><i class="fa fa-clock-o"></i>&nbsp;9 min read</span> </small></div><hr/><div class="markdown-style"><p><img class="lozad imgViewer mfp-zoom" data-mfp-src="/assets/img/posts/id_raspi_pico_zephyr_os_part2/mainen.jpg" data-src="/assets/img/posts/id_raspi_pico_zephyr_os_part2/mainen.jpg" alt="How to Debug Zephyr RTOS" data-align="center" /></p><p>In this post I will talk about, how to create Zephyr based applications and how to debug on Raspberry Pi Pico. I assume that you have finished set up the development environment. <a href="https://youtu.be/OyMyY4IwsJE">This video</a> explains how to set up the development environment, so please watch it first if needed.</p><div class="video-wrapper video-centered"><div class="video-container"> <iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/t-t-boemUZE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><h3 id="pick-a-sample-application">Pick a sample application</h3><p>Let’s pick a sample application, close enough to what we want to do. This time I need a sample for external GPIO Interrupts. Let’s check Zephyr sample applications.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd ~/zephyrproject/zephyr/samples
$ ls
application_development	drivers			posix
arch			hello_world		sensor
basic			index.rst		shields
bluetooth		kernel			subsys
boards			modules			synchronization
classic.rst		net			tfm_integration
compression		philosophers		userspace
$ cd basic
$ ls
basic.rst	blinky_pwm	fade_led	rgb_led		threads
blinky		button		minimal		servo_motor
$ cd button
$ ls
CMakeLists.txt	README.rst	prj.conf	sample.yaml	src
</code></pre></div></div><p>Let’s check button sample’s source code. Here is the GPIO interrupt config.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat src/main.c
...
void main(void)
{
...
    ret = gpio_pin_interrupt_configure_dt(&amp;button, GPIO_INT_EDGE_TO_ACTIVE);
...
    gpio_init_callback(&amp;button_cb_data, button_pressed, BIT(button.pin));
    gpio_add_callback(button.port, &amp;button_cb_data);
...
}
</code></pre></div></div><p>I will use this sample for my application base.</p><h3 id="how-to-make-standalone-zephyr-based-applications">How to make standalone Zephyr-based applications</h3><p>There are 3 types of applications.</p><ol><li>Applications in zephyrproject/zephyr/ folder called as Zephyr repository applications.</li><li>Applications in zephyrproject/ folder called as Zephyr workspace applications.</li><li>Applications outside of zephyrproject folder called as Zephyr freestanding applications.</li></ol><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;home&gt;/
├─── zephyrproject/
│     ├─── .west/
│     │    └─── config
│     ├─── zephyr/
│     │    ├── arch/
│     │    ├── boards/
│     │    ├── cmake/
│     │    ├── samples/
│     │    │   ├── hello_world/  -&gt; Zephyr repository application
│     │    │   └── ...
│     │    ├── tests/
│     │    └── ...
│     ├── bootloader/
│     ├── modules/
│     ├── ...
│     └── applications/
│         └── app/               -&gt; Zephyr workspace application
│
└─── app/                        -&gt; Zephyr freestanding application
     ├── CMakeLists.txt
     ├── prj.conf
     └── src/
         └── main.c
</code></pre></div></div><p>Zephyr Project Reference: <a href="https://docs.zephyrproject.org/latest/develop/application/index.html">Application Development</a></p><p>This time I will use freestanding application. Let’s start by copying the button sample folder. Please don’t use spaces for folder names. Otherwise it will not work.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/
cp -R ~/zephyrproject/zephyr/samples/basic/button ~/Desktop/gpio_int_test
</code></pre></div></div><p>First I will try to compile for nucleo board because button sample does work with no change.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd ~/Desktop/gpio_int_test
$ west build -b nucleo_f411re
usage: west [-h] [-z ZEPHYR_BASE] [-v] [-V] &lt;command&gt; ...
west: error: argument &lt;command&gt;: invalid choice: 'build' (choose from 'init', 'update', 'list', 'manifest', 'diff', 'status', 'forall', 'help', 'config', 'topdir', 'selfupdate')
$
</code></pre></div></div><p>According to documentation, we need to set some environment variables. But don’t rush, we will fix this later.</p><p>Zephyr Project Reference: <a href="https://docs.zephyrproject.org/latest/develop/env_vars.html">Environment Variables</a></p><p>Temporarily, I will run Zephyr environment script. With this, environment variables last until terminal closes.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ source ~/zephyrproject/zephyr/zephyr-env.sh
$ west build -b nucleo_f411re
-- west build: generating a build system
Loading Zephyr default modules (Zephyr base).
-- Application: /Users/user/Desktop/gpio_int_test
-- Found Python3: /usr/local/opt/python@3.9/bin/python3.9 (found suitable exact version "3.9.13") found components: Interpreter
-- Cache files will be written to: /Users/user/Library/Caches/zephyr
-- Zephyr version: 3.0.99 (/Users/user/zephyrproject/zephyr)
-- Found west (found suitable version "0.13.1", minimum required is "0.7.1")
-- Board: nucleo_f411re
...
[156/156] Linking C executable zephyr/zephyr.elf
Memory region         Used Size  Region Size  %age Used
           FLASH:       15108 B       512 KB      2.88%
            SRAM:        4416 B       128 KB      3.37%
        IDT_LIST:          0 GB         2 KB      0.00%
</code></pre></div></div><p>Successfully compiled.</p><h3 id="vs-code-project-setup">VS Code project setup</h3><p>Let’s setup standalone Zephyr application on VS Code. Open the project folder we just copied in VS Code. Delete build folder.</p><p>Let’s add Zephyr environment variables to VS Code. With this, environment variables are added to VS Code’s terminal.</p><ol><li>Create a new folder named .vscode</li><li>Create a new file named settings.json inside of it.</li><li>Copy and paste the config written below.<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
 "terminal.integrated.env.osx": {
     "PATH": "$HOME/zephyrproject/zephyr/scripts",
     "ZEPHYR_BASE": "${env:HOME}/zephyrproject/zephyr",
 },
 "terminal.integrated.env.linux": {
     "PATH": "$HOME/zephyrproject/zephyr/scripts:${env:PATH}",
     "ZEPHYR_BASE": "${env:HOME}/zephyrproject/zephyr",
 },
 "terminal.integrated.env.windows": {
     "PATH": "${env:USERPROFILE}\\zephyrproject\\zephyr\\scripts;${env:PATH}",
     "ZEPHYR_BASE": "${env:USERPROFILE}\\zephyrproject\\zephyr",
 },
}
</code></pre></div></div><p>You can find more about VS Code workspace settings <a href="https://github.com/MrGreensWorkshop/ZephyrOS_manifests_and_vscode_settings">from here</a>.</p></li><li>Then reopen the VS Code open terminal inside VS Code and try to compile.<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ west build -b nucleo_f411re
-- west build: generating a build system
Loading Zephyr default modules (Zephyr base).
-- Application: /Users/user/Desktop/gpio_int_test
-- Found Python3: /usr/local/opt/python@3.9/bin/python3.9 (found suitable exact version "3.9.13") found components: Interpreter
-- Cache files will be written to: /Users/user/Library/Caches/zephyr
-- Zephyr version: 3.0.99 (/Users/user/zephyrproject/zephyr)
-- Found west (found suitable version "0.13.1", minimum required is "0.7.1")
-- Board: nucleo_f411re
...
[156/156] Linking C executable zephyr/zephyr.elf
Memory region         Used Size  Region Size  %age Used
        FLASH:       15108 B       512 KB      2.88%
         SRAM:        4416 B       128 KB      3.37%
     IDT_LIST:          0 GB         2 KB      0.00%
</code></pre></div></div></li></ol><p>Successfully compiled.</p><p>Let’s set our board name. Open the CMakeLists file and add this <code class="language-plaintext highlighter-rouge">set(BOARD rpi_pico)</code> after <code class="language-plaintext highlighter-rouge">cmake_minimum_required</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
cmake_minimum_required(VERSION 3.20.0)
set(BOARD rpi_pico)
...
</code></pre></div></div><p>Let’s try to build without board option.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ west build -p
...
/Users/user/Desktop/gpio_int_test/src/main.c:22:2: error: #error "Unsupported board: sw0 devicetree alias is not defined"
   22 | #error "Unsupported board: sw0 devicetree alias is not defined"
      |  ^~~~~
[117/160] Building C object zephyr/drivers/gpio/CMakeFiles/drivers__gpio.dir/gpio_rpi_pico.c.obj
ninja: build stopped: subcommand failed.
FATAL ERROR: command exited with status 1: /usr/local/bin/cmake --build /Users/user/Desktop/gpio_int_test/build
</code></pre></div></div><p>We have compile error because raspberry pi pico board doesn’t have switch.</p><h3 id="adding-switch0">Adding switch0</h3><p>Let’s add switch0, for this we will use app overlay file. Let’s check switch0 definition in nucleo board’s device overlay file.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /Users/wizard/zephyrproject/zephyr/boards/arm/nucleo_f411re/nucleo_f411re.dts
...
/ {
	gpio_keys {
		compatible = "gpio-keys";
		user_button: button {
			label = "User";
			gpios = &lt;&amp;gpioc 13 GPIO_ACTIVE_LOW&gt;;
		};
	};

	aliases {
		led0 = &amp;green_led_2;
		sw0 = &amp;user_button;
	};
};
...
</code></pre></div></div><p>Let’s create a new app.overlay file and put what we need in it.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/ {
	gpio_keys {
		compatible = "gpio-keys";
		user_button: button {
			label = "User";
			gpios = &lt;&amp;gpio0 28 GPIO_ACTIVE_LOW&gt;;
		};
	};

	aliases {
		sw0 = &amp;user_button;
	};
};
</code></pre></div></div><p>Zephyr Project Reference: <a href="https://docs.zephyrproject.org/latest/build/dts/howtos.html">Devicetree HOWTOs</a></p><p>In my circuit, the switch connected to GPIO 28. I will show the schematic later.</p><p>Let’s try to compile.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ west build -p
WARNING: This looks like a fresh build and BOARD is unknown; so it probably won't work. To fix, use --board=&lt;your-board&gt;.
Note: to silence the above message, run 'west config build.board_warn false'
-- west build: generating a build system
...
[160/160] Linking C executable zephyr/zephyr.elf
Memory region         Used Size  Region Size  %age Used
      BOOT_FLASH:         256 B        256 B    100.00%
           FLASH:       11940 B    2096896 B      0.57%
            SRAM:        3760 B       264 KB      1.39%
        IDT_LIST:          0 GB         2 KB      0.00%
Converting to uf2, output size: 24576, start address: 0x10000000
Wrote 24576 bytes to zephyr.uf2
$ gpio_int_test %
</code></pre></div></div><p>Voilà!</p><p>Our binary file is located in build/zephyr folder.</p><p>For more about west command please check the link below.</p><p>Zephyr Project Reference: <a href="https://docs.zephyrproject.org/latest/develop/west/build-flash-debug.html">Building, Flashing and Debugging</a></p><h3 id="how-to-debug">How to debug?</h3><p>On-chip debugging with Zephyr RTOS + App on Raspberry Pi Pico</p><p>What we need?</p><ul><li>Hardware debugger interface (SWD)<ul><li>A Raspberry Pi Pico flashed with picoprobe firmware</li></ul></li><li>Software for on-chip debugging<ul><li>OpenOCD build for picoprobe</li><li>Arm toolchain<ul><li>arm-none-eabi-gdb</li></ul></li><li>Cortex-Debug extension for VS Code</li></ul></li></ul><p>For on-chip debugging we need some hardware and software. Let’s prepare one by one.</p><h4 id="hardware-debugger-interface">Hardware debugger interface</h4><p>First hardware, I will use picoprobe for Hardware debugger interface.</p><p><img class="lozad imgViewer mfp-zoom" data-mfp-src="/assets/img/posts/id_raspi_pico_zephyr_os_part2/Shotcut_00_04_51_700_hw_if.jpg" data-src="/assets/img/posts/id_raspi_pico_zephyr_os_part2/Shotcut_00_04_51_700_hw_if.jpg" alt="PicoProbe" data-align="center" /></p><p>Let’s get the compiled binary for picoprobe and flash to Raspberry Pi Pico. Open <a href="https://www.raspberrypi.com/documentation/microcontrollers/raspberry-pi-pico.html#debugging-using-another-raspberry-pi-pico">this link</a>.</p><p>Find the link under the title <code class="language-plaintext highlighter-rouge">Debugging using another Raspberry Pi Pico</code> and download from <code class="language-plaintext highlighter-rouge">Download the UF2 file</code></p><p>Put the Raspberry Pi Pico into bootloader mode by pushing bootsel button, while plugging to your computer. Then copy the UF2 file to your Pico’s storage.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cp ~/Downloads/picoprobe.uf2 /Volumes/RPI-RP2/
</code></pre></div></div><h4 id="building-openocd">Building OpenOCD</h4><p>Currently OpenOCD does not officially support the picoprobe. So, we need to build a specific version of OpenOCD.</p><p><em>For macOS</em></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/
brew install libtool automake libusb wget pkg-config gcc texinfo
git clone https://github.com/raspberrypi/openocd.git --branch picoprobe --depth=1
cd openocd
export PATH="/usr/local/opt/texinfo/bin:$PATH"
./bootstrap
./configure --enable-picoprobe --disable-werror
make -j4
</code></pre></div></div><p><em>For Linux</em></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/pico
sudo apt install automake autoconf build-essential texinfo libtool libftdi-dev libusb-1.0-0-dev
git clone https://github.com/raspberrypi/openocd.git --branch picoprobe --depth=1 --no-single-branch
cd openocd
./bootstrap
./configure --enable-picoprobe
make -j4
sudo make i
</code></pre></div></div><p>Since this is a Pico-specific version of OpenOCD, you don’t need to run “make install”. We will add OpenOCD’s paths to VS Code later.</p><p>Let’s check the OpenOCD.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ~/openocd/src/openocd --version
Open On-Chip Debugger 0.11.0-g4f2ae61 (2022-06-08-15:59)
Licensed under GNU GPL v2
For bug reports, read
	http://openocd.org/doc/doxygen/bugs.html
</code></pre></div></div><h4 id="installing-arm-tools">Installing ARM tools</h4><p><em>For macOS</em></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/
brew tap eblot/armeabi
brew install arm-none-eabi-gdb
</code></pre></div></div><p>Let’s check the arm-none-eabi-gdb.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ arm-none-eabi-gdb --version
GNU gdb (GDB) 10.1
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
</code></pre></div></div><h4 id="vs-code-settings">VS Code Settings</h4><ol><li>First install Cortex-Debug extension.</li><li>Open settings.json file and add OpenOCD binary path.<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
 "cortex-debug.openocdPath": "${env:HOME}/openocd/src/openocd",
 ...
</code></pre></div></div></li><li>Create a new file named launch.json inside of .vscode folder and add all these settings.<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "version": "0.2.0",
  "configurations": [{
 "name": "Pico Zephyr Debug",
 "device": "RP2040",
 "gdbPath": "arm-none-eabi-gdb",
 "cwd": "${workspaceRoot}",
 "executable": "build/zephyr/zephyr.elf",
 "request": "launch",
 "type": "cortex-debug",
 "servertype": "openocd",
 "configFiles": [
   "/interface/picoprobe.cfg",
   "/target/rp2040.cfg"
 ],
 "searchDir": ["${env:HOME}/openocd/tcl"],
 "svdFile": "${env:HOME}/zephyrproject/modules/hal/rpi_pico/src/rp2040/hardware_regs/rp2040.svd",
 "runToEntryPoint": "main",
 "postRestartCommands": [
   "break main",
   "continue"
 ]
  }]
}
</code></pre></div></div></li></ol><h4 id="final-schematic">Final Schematic</h4><p>This is the schematic for my setup. Hardware debugger interface on the left, and the target board with the button on the right.</p><p><img class="lozad imgViewer mfp-zoom" data-mfp-src="/assets/img/posts/id_raspi_pico_zephyr_os_part2/pico_probe_hw_with_targe_sw.jpg" data-src="/assets/img/posts/id_raspi_pico_zephyr_os_part2/pico_probe_hw_with_targe_sw.jpg" alt="Schematic diagram" data-align="center" /></p><h4 id="lets-start-debugging">Let’s start debugging</h4><p>Open main.c and click the left side of line numbers. Breakpoints will be added accordingly.</p><p><img class="lozad imgViewer mfp-zoom" data-mfp-src="/assets/img/posts/id_raspi_pico_zephyr_os_part2/Shotcut_00_07_19_500_breakpoint.jpg" data-src="/assets/img/posts/id_raspi_pico_zephyr_os_part2/Shotcut_00_07_19_500_breakpoint.jpg" alt="Breakpoints" data-align="center" /></p><p>Don’t forget to compile before debugging. Then click the Run and Debug icon on the left, and click Start Debugging on top left.</p><p><img class="lozad imgViewer mfp-zoom" data-mfp-src="/assets/img/posts/id_raspi_pico_zephyr_os_part2/debug.jpg" data-src="/assets/img/posts/id_raspi_pico_zephyr_os_part2/debug.jpg" alt="Debugging" data-align="center" /></p><p>Voilà!</p><p>Let’s check with the serial terminal to see Zephyr console output. I will push the button and check the console output.</p><p><img class="lozad imgViewer mfp-zoom" data-mfp-src="/assets/img/posts/id_raspi_pico_zephyr_os_part2/Shotcut_00_08_48_567_debug_ser.jpg" data-src="/assets/img/posts/id_raspi_pico_zephyr_os_part2/Shotcut_00_08_48_567_debug_ser.jpg" alt="Debug and Console Output" data-align="center" /></p><p>Awesome!</p><h3 id="you-can-support-my-work">You Can Support My Work</h3><p>Creating projects like this takes a great amount of time. Much appreciated if you consider supporting me so that I can continue projects like this and creating new contents for everyone.</p><p>You might consider supporting me via GitHub Sponsors, Patreon, or Ko-fi. For links, please see the <a href="/tabs/about.html">About page</a>.</p><h3 id="final-words">Final words</h3><p>You can access the Raspberry Pi Pico Zephyr RTOS VS Code project from <a href="https://github.com/MrGreensWorkshop/ZephyrOS_ButtonRasPiPicoVScodeDebug">this link</a>.</p><p>Don’t forget to check out the <a href="2023-03-24-raspberry-pi-pico-zephyr-rtos-picodro">Zephyr RTOS Real Application Tutorial series</a>.</p><hr><div class="share-holder"> <span class="share-label">Share on: </span><ul class="share-buttons"><li> <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fwww.mrgreensworkshop.com%2Fposts%2F2022-06-10-raspberry-pi-pico-zephyr-os-part-2&amp;text=Let&#39;s%20create%20Zephyr%20RTOS%20based%20app%20and%20start%20debugging%20with%20Raspberry%20Pi%20Pico%20in%20VS%20Code%20-%20Mr.%20Green&#39;s%20Workshop" aria-label="Twitter" role="button" target="_blank" rel="noopener noreferrer" data-toggle="tooltip" data-placement="top" title="Twitter" class="hover-effect-big"> <i class="fa fa-twitter-square fa-fw" aria-hidden="true"></i> </a></li><li> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.mrgreensworkshop.com%2Fposts%2F2022-06-10-raspberry-pi-pico-zephyr-os-part-2" aria-label="Facebook" role="button" target="_blank" rel="noopener noreferrer" data-toggle="tooltip" data-placement="top" title="Facebook" class="hover-effect-big"> <i class="fa fa-facebook-square fa-fw" aria-hidden="true"></i> </a></li><li> <a href="https://t.me/share/url?url=https%3A%2F%2Fwww.mrgreensworkshop.com%2Fposts%2F2022-06-10-raspberry-pi-pico-zephyr-os-part-2&amp;text=Let&#39;s%20create%20Zephyr%20RTOS%20based%20app%20and%20start%20debugging%20with%20Raspberry%20Pi%20Pico%20in%20VS%20Code%20-%20Mr.%20Green&#39;s%20Workshop" aria-label="Telegram" role="button" target="_blank" rel="noopener noreferrer" data-toggle="tooltip" data-placement="top" title="Telegram" class="hover-effect-big"> <i class="fa fa-telegram fa-fw" aria-hidden="true"></i> </a></li><li> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.mrgreensworkshop.com%2Fposts%2F2022-06-10-raspberry-pi-pico-zephyr-os-part-2" aria-label="LinkedIn" role="button" target="_blank" rel="noopener noreferrer" data-toggle="tooltip" data-placement="top" title="LinkedIn" class="hover-effect-big"> <i class="fa fa-linkedin-square fa-fw" aria-hidden="true"></i> </a></li><li> <a href="mailto:?subject=Let&#39;s%20create%20Zephyr%20RTOS%20based%20app%20and%20start%20debugging%20with%20Raspberry%20Pi%20Pico%20in%20VS%20Code%20-%20Mr.%20Green&#39;s%20Workshop&amp;body=Let&#39;s%20create%20Zephyr%20RTOS%20based%20app%20and%20start%20debugging%20with%20Raspberry%20Pi%20Pico%20in%20VS%20Code%20-%20Mr.%20Green&#39;s%20Workshop%20https%3A%2F%2Fwww.mrgreensworkshop.com%2Fposts%2F2022-06-10-raspberry-pi-pico-zephyr-os-part-2" aria-label="Email" role="button" target="_blank" rel="noopener noreferrer" data-toggle="tooltip" data-placement="top" title="Email" class="hover-effect-big"> <i class="fa fa-envelope fa-fw" aria-hidden="true"></i> </a></li><li> <a href="javascript:void(0);" aria-label="Copy link" role="button" onclick="copyToClipboard('https://www.mrgreensworkshop.com/posts/2022-06-10-raspberry-pi-pico-zephyr-os-part-2', 'Link copied!')" id="copytoclipboard" data-toggle="tooltip" data-placement="top" title="Copy link" class="hover-effect-big"> <i class="fa fa-link fa-fw" aria-hidden="true"></i> </a></li></ul></div></div></div><div class="pagination_wrapper"><nav aria-label="Page navigation"><ul class="pagination" style="opacity:0"><li><a href="javascript:void(0);" role="button">1</a></li></ul></nav></div><div id="comment_thread"><div id="giscus_thread"></div></div><noscript> Please enable JavaScript to view the Comments. </noscript></div><div class="footer-wrapper"><div class="footer-container"><footer translate="no"><div class="footer-text footer-text-centered long-copyright"><p>&copy; 2022 Mr. Green's Workshop. All rights reserved.</p></div><p class="footer-powered"><span>Pwrd by </span><a href="https://github.com/MrGreensWorkshop/MrGreen-JekyllTheme" target="_blank" rel="noopener noreferrer">Mr. Green</a></p></footer></div></div><div class="scroll-to-top-container"> <a id="scroll-to-top" href="#main-wrapper" role="button" aria-label="Back to top" class="hover-effect"><i class="fa fa-angle-up"></i></a></div></div><div class="searchbox-container"> <form id="searchbox-form" autocomplete="off"> <input type="search" id="search-box" placeholder="Search" onkeyup="if(this.value!==''){document.getElementById('search-results').style.display = 'block';}" onfocusout="this.value='';" onblur="setTimeout(function(){ document.getElementById('search-results').style.display = 'none'; }, 100);"><ul id="search-results" ></ul></form></div><script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v0.4.1/dist/bootstrap-toc.min.js"></script> <script src="/assets/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script> <script> $('.imgViewer[data-no-image-viewer]').css("cursor", "unset"); $(function () { $('.imgViewer:not([data-no-image-viewer])').magnificPopup({ type: 'image' ,image: { titleSrc: 'alt' /* Error message */ ,tError: "The image could not be loaded.<br><br>%url%" /* Set to null to disable zoom out cursor. */ /*,cursor: null */ } ,closeOnContentClick: true ,showCloseBtn: false ,zoom: { /* By default it's false, so don't forget to enable it */ enabled: true /* duration of the effect, in milliseconds */ ,duration: 300 /* CSS transition easing function */ ,easing: 'ease-in-out' } }); }); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js"></script> <script> /* lazy loads elements with default selector as '.lozad' */ const observer = lozad(); observer.observe(); </script> <script> PagerPageNumbers.setProperties({ paginatorListContainerName: ".pagination_wrapper .pagination" ,pageList: ["/posts/2023-03-24-raspberry-pi-pico-zephyr-rtos-picodro", "/posts/2023-02-16-raspberry-pi-pico-w-bluetooth-classic-spp", "/posts/2022-06-10-raspberry-pi-pico-zephyr-os-part-2", "/posts/2022-05-29-diy-3d-printer-part-2", "/posts/2022-05-29-diy-3d-printer-part-1", "/posts/2022-03-03-mr-green-jekyll-theme"] ,firstButtonName: "First" ,lastButtonName: "Last" ,prevButtonName: "«" ,nextButtonName: "»" }); </script> <script src="/assets/js/simple-jekyll-search-1.9.2.min.js"></script><script> function loadSearch(jsonData, searchParam) { if (!jsonData) jsonData = '/query/search.json'; var searchInput = document.getElementById('search-box'); const simpleJekyllSearch = SimpleJekyllSearch({ searchInput: searchInput ,resultsContainer: document.getElementById('search-results') ,json: jsonData ,searchResultTemplate: '<li> <a href="{url}"><div><div class="title">{title}</div><div class="date">{date}</div><div style="clear: both;"></div></div></a></li>' ,noResultsText: '<li>No results were found.</li>' ,limit: 10 ,fuzzy: false ,formSubmit: document.getElementById('searchbox-form') }); if (searchParam) { searchInput.value = searchParam; searchInput.focus(); searchInput.disabled=false; setTimeout(function(){ simpleJekyllSearch.search(searchParam); }, 400); } } </script> <script> let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "MrGreensWorkshop/comments", "data-repo-id": "R_kgDOI4CvPA", "data-category": "mrgreensworkshop", "data-category-id": "DIC_kwDOI4CvPM4CUDTQ", "data-mapping": "pathname", "data-strict": "1", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-input-position": "bottom", "data-theme": giscusGetColorTheme(), "data-lang": "en", "data-loading": "lazy", "crossorigin": "anonymous", "async": "" }; function engineLoader() { let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("giscus_thread").appendChild(giscusScript); } /* set giscus theme, when data-color-scheme changes. (dark, light) */ function giscusGetColorTheme() { let theme = "light_protanopia"; if (document.body.dataset.colorScheme == "light") { theme = "light_protanopia"; } else if (document.body.dataset.colorScheme == "dark") { theme = "dark_protanopia"; } return theme; } function giscusSetColorScheme() { function giscusSetConfig(config) { const giscusIframe = document.querySelector('iframe.giscus-frame'); if (!giscusIframe) return; giscusIframe.contentWindow.postMessage({ giscus: config }, 'https://giscus.app'); } giscusSetConfig({ setConfig: { theme: giscusGetColorTheme() } }); } const color_scheme_observer = new MutationObserver(giscusSetColorScheme); color_scheme_observer.observe(document.body, {attributeFilter: ["data-color-scheme"]}); /* load when slide to the end of page */ let isMobile = false; function page_bottom_Check(event) { let wind = event.target.scrollingElement; let showBeforeEndOffset = 50; if (isMobile) { /* mobile fix */ showBeforeEndOffset += 56; } if (wind.offsetHeight + wind.scrollTop >= wind.scrollHeight - commentPageOffset - showBeforeEndOffset) { engineLoader(); document.removeEventListener('scroll', page_bottom_Check); slideToComments(); } } const commentPageOffset = document.querySelector('#comment_thread').clientHeight; document.addEventListener('scroll', page_bottom_Check); window.addEventListener("load", function() { isMobile = navigator.userAgent.toLowerCase().match(/mobile/i); let checkScroll = true; if (isMobile) { /* mobile fix */ clientHeight = document.documentElement.clientHeight + 56; } else { clientHeight = document.documentElement.clientHeight; } const scroll_enabled = document.documentElement.scrollHeight > clientHeight; if (checkScroll == true && scroll_enabled == false) { /* if no scroll bar, load at startup */ document.removeEventListener('scroll', page_bottom_Check); engineLoader(); slideToComments(); } }); /* scroll to page bottom to see comments. */ function slideToComments() { document.getElementById('comment_thread').style.minHeight = '324px'; window.scrollTo(0, document.body.scrollHeight); } </script> <script> CookieConsent.consentSettingHtml = "<div class=\"consent-settings\"><h5>Cookie settings</h5><br><p class=\"info-text\">This website uses cookies to optimize site functionality. It will be activated with your approval. Please click each item below for cookie policy.</p><table><tr><td onclick=\"$('.info[data-consent-info=necessary]').slideToggle();$(this).children('i').toggleClass('fa-plus-square-o').toggleClass('fa-minus-square-o')\"> <i class=\"fa-fw fa fa-plus-square-o\" aria-hidden=\"true\"></i><p>Strictly necessary cookies</p></td><td> <span class=\"active_text\">Always active</span></td></tr></table><div class=\"info\" data-consent-info=\"necessary\"><p>These cookies are essential for the website function and cannot be disable. They are usually set when site function like color scheme etc. is changed. These cookies do not store any personally identifiable information. Enables storage related to security such as authentication functionality, fraud prevention, and other user protection.</p></div><table><tr><td onclick=\"$('.info[data-consent-info=analytics]').slideToggle();$(this).children('i').toggleClass('fa-plus-square-o').toggleClass('fa-minus-square-o')\"> <i class=\"fa-fw fa fa-plus-square-o\" aria-hidden=\"true\"></i><p>Performance cookies</p></td><td> <span class=\"active_text\">Always active</span></td></tr></table><div class=\"info\" data-consent-info=\"analytics\"><p>Enables storage (such as cookies) related to analytics e.g. visit duration.</p></div><table><tr><td onclick=\"$('.info[data-consent-info=preferences]').slideToggle();$(this).children('i').toggleClass('fa-plus-square-o').toggleClass('fa-minus-square-o')\"> <i class=\"fa-fw fa fa-plus-square-o\" aria-hidden=\"true\"></i><p>Functionality cookies</p></td><td> <label class=\"slide-switch\"> <input type=\"checkbox\" class=\"checkbox_switch\" data-consent=\"preferences\"> <span class=\"slider\"></span> </label></td></tr></table><div class=\"info\" data-consent-info=\"preferences\"><p>Enables storage that supports the functionality of the website or app e.g. language settings. Enables storage related to personalization e.g. video recommendations.</p></div><table><tr><td onclick=\"$('.info[data-consent-info=advertising]').slideToggle();$(this).children('i').toggleClass('fa-plus-square-o').toggleClass('fa-minus-square-o')\"> <i class=\"fa-fw fa fa-plus-square-o\" aria-hidden=\"true\"></i><p>Targeting and advertising cookies</p></td><td> <label class=\"slide-switch\"> <input type=\"checkbox\" class=\"checkbox_switch\" data-consent=\"advertising\"> <span class=\"slider\"></span> </label></td></tr></table><div class=\"info\" data-consent-info=\"advertising\"><p>Enables storage (such as cookies) related to advertising.</p></div><br><div class=\"button-holder\"> <a href=\"javascript:void(0);\" class=\"btn-base btn-left\" onclick=\"CookieConsent.consentSettingDone('deny');\" role=\"button\" rel=\"nofollow\">Deny</a> <a href=\"javascript:void(0);\" class=\"btn-base btn-priority\" onclick=\"CookieConsent.consentSettingDone('accept');\" role=\"button\" rel=\"nofollow\">Allow all</a> <a href=\"javascript:void(0);\" class=\"btn-base \" onclick=\"CookieConsent.consentSettingDone('save');\" role=\"button\" rel=\"nofollow\">Allow selection</a></div></div>"; CookieConsent.consentSettingSlideType = 'slideBoxTopToDown'; CookieConsent.consentBarHtml = "<div class=\"consent-bar\"> <a class=\"close-button\" href=\"javascript:void(0);\" onclick=\"CookieConsent.hideConsentBar();\" aria-label=\"Close\" role=\"button\" rel=\"nofollow\"><i class=\"fa-fw fa fa-times\"></i></a><p>This website uses cookies to optimize site functionality. It will be activated with your approval.</p><a href=\"javascript:void(0);\" class=\"btn-base \" onclick=\"CookieConsent.consentBarDone('deny');\" role=\"button\" rel=\"nofollow\">Deny</a> <a href=\"javascript:void(0);\" class=\"btn-base \" onclick=\"CookieConsent.consentBarDone('settings');\" role=\"button\" rel=\"nofollow\">Customize</a> <a href=\"javascript:void(0);\" class=\"btn-base btn-priority\" onclick=\"CookieConsent.consentBarDone('accept');\" role=\"button\" rel=\"nofollow\">Allow all</a></div>"; CookieConsent.consent_items = JSON.parse('{"necessary":{"group":["security_storage"],"value":"granted","wait_for_update":500,"cookie_domain":"www.mrgreensworkshop.com","no_check_box":true},"analytics":{"group":["analytics_storage"],"value":"granted","no_check_box":true},"preferences":{"group":["functionality_storage","personalization_storage"],"value":"denied"},"advertising":{"group":["ad_storage"],"value":"denied"}}'); CookieConsent.hideConsentBarWithSaveButton = true; const consent_settings = CookieConsent.getConsentSettings(); const default_configs = JSON.parse('{"anonymize_ip":true,"ads_data_redaction":true,"cookie_flags":"SameSite=None;Secure"}'); </script> <script> window.dataLayer = window.dataLayer || []; function gtag() {dataLayer.push(arguments);} CookieConsent.gtag = gtag; if (Object.keys(consent_settings).length > 0) gtag("consent", "default", consent_settings); if (Object.keys(default_configs).length > 0) gtag("set", default_configs); </script><script defer src="https://www.googletagmanager.com/gtag/js?id=G-SC87NNMPP8"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() {dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-SC87NNMPP8'); </script> <script> LangOfferMsgBox.currentPageLng = "en"; LangOfferMsgBox.supportedLngList = [["en","En","/","View this page in English.","To home","Language"],["ja","Jp","/ja","このページを日本語で表示する。","日本語ホームへ","言語"]]; LangOfferMsgBox.existLng = [["ja","Jp","/ja/2022-06-16-raspberry-pi-pico-zephyr-os-part-2"]]; LangOfferMsgBox.disableExtTranslationOffer = true; LangOfferMsgBox.slideType = 'slideBoxTopToDown'; </script> <script> SlidingMsgBox.html = "<div class=\"slideBox\"> <a class=\"close-button\" href=\"javascript:void(0);\" aria-label=\"Close\" role=\"button\" rel=\"nofollow\"><i class=\"fa-fw fa fa-times\"></i></a></div>"; </script></body></html>
